const indexOfPatternControl=(t,e,o=1)=>t?.indexOf(e,o),lastIndexOfPatternControl=(t,e,o=1)=>t?.lastIndexOf(e,o),dateControl=new Date,todayControl=`${dateControl.getDate()}/${dateControl.getMonth()+1}/`+dateControl.getFullYear(),tableContainerControl=document.createElement("div"),buttonContainerControl=(tableContainerControl.id="table-container",document.body.appendChild(tableContainerControl),document.createElement("div")),updateButtonControl=(buttonContainerControl.id="button-container",buttonContainerControl.style.marginBottom="20px",buttonContainerControl.style.textAlign="center",tableContainerControl.appendChild(buttonContainerControl),document.createElement("button")),copyButtonControl=(updateButtonControl.textContent="üîÑ Actualizar",updateButtonControl.title="Actualizar datos de la p√°gina",buttonContainerControl.appendChild(updateButtonControl),document.createElement("button")),updateCopyButtonControl=(copyButtonControl.textContent="üìã Copiar",copyButtonControl.title="Copiar tabla al portapapeles",buttonContainerControl.appendChild(copyButtonControl),document.createElement("button")),tableControl=(updateCopyButtonControl.textContent="‚ö° Actualizar y Copiar",updateCopyButtonControl.title="Actualizar datos y copiar autom√°ticamente",buttonContainerControl.appendChild(updateCopyButtonControl),document.createElement("table")),divControl=(tableControl.id="driver-table",tableContainerControl.appendChild(tableControl),document.createElement("div")),buttonTopControl=(divControl.className="floating-buttons",document.createElement("button")),buttonControl=(buttonTopControl.className="floating-button",buttonTopControl.innerHTML="‚¨ÜÔ∏è",buttonTopControl.title="Ir al inicio de la p√°gina",divControl.appendChild(buttonTopControl),document.createElement("button")),headerRowControl=(buttonControl.className="floating-button",buttonControl.innerHTML="üìä",buttonControl.title="Ir a la tabla",divControl.appendChild(buttonControl),document.body.appendChild(divControl),tableControl.insertRow(0)),headersControl=["Ruta","Nombre","Patente","ID Ruta","Entregados","Fallidos","Fecha","Horas","Minutos"];function extractTimeFromText(t){if(t)for(const o of[/(\d+):(\d+)\s*hs/i,/(\d+):(\d+)/,/(\d+)\s*hs?\s*(\d+)\s*min/i,/(\d+)\s*horas?\s*(\d+)\s*minutos?/i]){var e=t.match(o);if(e)return{hours:parseInt(e[1],10)||0,minutes:parseInt(e[2],10)||0}}return{hours:0,minutes:0}}headersControl.forEach(t=>{var e=document.createElement("th");e.textContent=t,e.setAttribute("data-sort-order","Descendente"),headerRowControl.appendChild(e)});let isInitialLoad=!0;function buildTable(){tableControl.querySelectorAll("tr:not(:first-child)").forEach(t=>t.remove()),document.querySelectorAll(".row-link").forEach(t=>{let e="",o="",n="",r="";try{var a=t.querySelector(".monitoring-row__bold"),l=(a&&a.innerText&&(e=a.innerText,-1!==(v=indexOfPatternControl(e,"#")))&&(o=e.slice(v+1)),t.querySelector(".monitoring-row-details__driver-name")),i=(l&&l.innerText&&(n=l.innerText),t.querySelector(".monitoring-row-details__license"));i&&i.innerText&&(r=i.innerText)}catch(t){console.warn("Error al obtener datos b√°sicos:",t)}let d="-";try{r&&-1!==(E=indexOfPatternControl(r,"|"))&&-1!==(A=indexOfPatternControl(r,"|",E+1))&&E+2<A&&(d=r.slice(E+2,A-1))}catch(t){console.warn("Error al extraer patente:",t),d="-"}let c="";try{var s=t.querySelector(".monitoring-row-shipments__data");s&&s.innerText&&(c=s.innerText)}catch(t){console.warn("Error al obtener datos de entregas:",t),c=""}var u,C,a={indexEntregados:0,indexFallidos:0,entregadosTwoDigits:!1,fallidosTwoDigits:!1,entregados:0,fallidos:0,idRuta:"",patente:"",fecha:"",horas:"",minutos:""};let p=0,m=0;try{var b=t.innerText,h=(console.log("Texto completo de la fila:",b),extractTimeFromText(b));if(p=h.hours,m=h.minutes,console.log(`M√©tricas extra√≠das: ${p} horas, ${m} minutos`),0===p&&0===m){console.log("No se encontr√≥ tiempo en el texto general, buscando en elementos espec√≠ficos...");var x=t.querySelectorAll("div");for(let t=0;t<x.length;t++){var y=x[t].innerText,T=extractTimeFromText(y);if(0<T.hours||0<T.minutes){p=T.hours,m=T.minutes,console.log(`Tiempo encontrado en div ${t}:`,y);break}}}}catch(t){console.warn("Error al obtener m√©tricas:",t),p=0,m=0}let g="0",f=0;try{c&&((B=indexOfPatternControl(c,"entregados")||indexOfPatternControl(c,"entregado"))&&0<B&&(g=c.slice(0,B-1).trim()),-1!==(u=indexOfPatternControl(c,"|")))&&u+2<c.length&&(a.indexFallidos=u+2,C=" "===c[a.indexFallidos+1],a.fallidosTwoDigits=!C,f=a.fallidosTwoDigits?parseInt(c.slice(a.indexFallidos,a.indexFallidos+2))||0:parseInt(c.slice(a.indexFallidos,a.indexFallidos+1))||0)}catch(t){console.warn("Error al extraer datos de entregas:",t),g="0",f=0}var v=document.createElement("tr"),l=document.createElement("td"),i=(l.textContent=e,v.appendChild(l),document.createElement("td")),E=(i.textContent=n,v.appendChild(i),document.createElement("td")),A=(E.textContent=d,v.appendChild(E),document.createElement("td")),s=(A.textContent=o,v.appendChild(A),document.createElement("td")),b=(s.textContent=g,v.appendChild(s),document.createElement("td")),h=(b.textContent=f,v.appendChild(b),document.createElement("td")),t=(h.textContent=todayControl,v.appendChild(h),document.createElement("td")),B=(t.textContent=p,v.appendChild(t),document.createElement("td"));B.textContent=m,v.appendChild(B),tableControl.appendChild(v)}),isInitialLoad&&(addSortingFunctionality(),isInitialLoad=!1)}function sortTableByColumn(r,a=!0){var t=document.querySelectorAll("#driver-table th"),e=Array.from(tableControl.querySelectorAll("tr")).slice(1);t.forEach(t=>t.removeAttribute("data-sort-order")),e.sort((t,e)=>{var o,n,t=t.cells[r].textContent.trim(),e=e.cells[r].textContent.trim();return 0===r?(n=extractRouteInfo(t),o=extractRouteInfo(e),console.log(`Comparando rutas: "${t}" (${n}) vs "${e}" (${o})`),a?n-o:o-n):3===r||4===r||5===r||7===r||8===r?(o=parseFloat(t)||0,n=parseFloat(e)||0,a?o-n:n-o):a?t.localeCompare(e):e.localeCompare(t)}),e.forEach(t=>tableControl.tBodies[0].appendChild(t)),t[r]&&t[r].setAttribute("data-sort-order",a?"Descendente":"Ascendente")}function updateTable(){console.log("Iniciando actualizaci√≥n de tabla..."),buildTable(),setTimeout(()=>{sortTableByColumn(0,!0),console.log("Tabla actualizada y ordenada por rutas (ascendente)")},100)}function copyTableToClipboard(){var e=tableControl.querySelectorAll("tr");let o="";for(let t=1;t<e.length;t++){var n=e[t].querySelectorAll("td"),n=Array.from(n).map(t=>t.textContent.trim());o+=n.join("\t")+"\n"}navigator.clipboard.writeText(o).then(()=>{console.log("Tabla copiada al portapapeles");const t=copyButtonControl.textContent;copyButtonControl.textContent="‚úÖ ¬°Copiado!",copyButtonControl.style.background="linear-gradient(135deg, #4CAF50 0%, #45a049 100%)",copyButtonControl.style.transform="scale(1.1)",setTimeout(()=>{copyButtonControl.textContent=t,copyButtonControl.style.background="linear-gradient(135deg, #2196F3 0%, #1976D2 100%)",copyButtonControl.style.transform="scale(1)"},2e3)}).catch(t=>{console.error("Error al copiar: ",t)})}function updateAndCopy(){console.log("Iniciando actualizaci√≥n y copia..."),buildTable(),setTimeout(()=>{sortTableByColumn(0,!0),console.log("Tabla actualizada y ordenada por rutas (ascendente)"),setTimeout(()=>{copyTableToClipboard()},100)},100)}function extractRouteInfo(t){var e,o=t.match(/^([A-Z])(\d+)/);return o?(e=o[1],o=parseInt(o[2],10),1e3*(e.charCodeAt(0)-"A".charCodeAt(0)+1)+o):(e=t.match(/(\d+)/))?parseInt(e[1],10):0}function isNumeric(t){return!isNaN(parseFloat(t))&&isFinite(t)}function addSortingFunctionality(){document.querySelectorAll("#driver-table th").forEach(t=>{t.hasAttribute("data-sort-listener")||(t.setAttribute("data-sort-listener","true"),t.addEventListener("click",()=>{console.log("Ordenado"),sortTableByColumn(Array.from(t.parentNode.children).indexOf(t),"Ascendente"===t.getAttribute("data-sort-order"))}))})}buildTable(),updateButtonControl.addEventListener("click",updateTable),copyButtonControl.addEventListener("click",copyTableToClipboard),updateCopyButtonControl.addEventListener("click",updateAndCopy),addSortingFunctionality(),buttonControl.addEventListener("click",()=>{console.log("Bot√≥n tabla clickeado - yendo a botones de control");var t=buttonContainerControl.getBoundingClientRect(),e=window.pageYOffset||document.documentElement.scrollTop,t=t.top+e-60;window.scrollTo({top:t,behavior:"smooth"})}),buttonTopControl.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})});